{"version":3,"sources":["../../../../../../client/node_modules/@babel/helper-create-class-features-plugin/lib/index.js"],"names":["Object","defineProperty","exports","value","createClassFeaturePlugin","enumerable","get","_features","FEATURES","_helperFunctionName","data","_interopRequireDefault","require","_helperSplitExportDeclaration","_fields","_decorators","_misc","_package","obj","__esModule","default","version","split","reduce","v","x","versionKey","name","feature","loose","manipulateOptions","pre","enableFeature","file","set","visitor","Class","path","state","verifyUsedFeatures","isLoose","constructor","isDecorated","hasOwnDecorators","node","props","elements","computedPaths","privateNames","Set","body","computed","push","isPrivate","key","id","getName","setName","kind","has","buildCodeFrameError","add","isClassMethod","isProperty","length","ref","isClassExpression","scope","generateUidIdentifier","privateNamesMap","buildPrivateNamesMap","privateNamesNodes","buildPrivateNamesNodes","transformPrivateNamesUsage","keysNodes","staticNodes","instanceNodes","wrapClass","buildDecoratedClass","extractComputedKeys","buildFieldsInitNodes","superClass","injectInitialization","referenceVisitor","prop","static","traverse","insertBefore","insertAfter","PrivateName","ExportDefaultDeclaration","decl","isClassDeclaration","hasDecorators","type"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createClassFeaturePlugin = createClassFeaturePlugin;\nObject.defineProperty(exports, \"FEATURES\", {\n  enumerable: true,\n  get: function () {\n    return _features.FEATURES;\n  }\n});\n\nfunction _helperFunctionName() {\n  const data = _interopRequireDefault(require(\"@babel/helper-function-name\"));\n\n  _helperFunctionName = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _helperSplitExportDeclaration() {\n  const data = _interopRequireDefault(require(\"@babel/helper-split-export-declaration\"));\n\n  _helperSplitExportDeclaration = function () {\n    return data;\n  };\n\n  return data;\n}\n\nvar _fields = require(\"./fields\");\n\nvar _decorators = require(\"./decorators\");\n\nvar _misc = require(\"./misc\");\n\nvar _features = require(\"./features\");\n\nvar _package = _interopRequireDefault(require(\"../package.json\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst version = _package.default.version.split(\".\").reduce((v, x) => v * 1e5 + +x, 0);\n\nconst versionKey = \"@babel/plugin-class-features/version\";\n\nfunction createClassFeaturePlugin({\n  name,\n  feature,\n  loose,\n  manipulateOptions\n}) {\n  return {\n    name,\n    manipulateOptions,\n\n    pre() {\n      (0, _features.enableFeature)(this.file, feature, loose);\n\n      if (!this.file.get(versionKey) || this.file.get(versionKey) < version) {\n        this.file.set(versionKey, version);\n      }\n    },\n\n    visitor: {\n      Class(path, state) {\n        if (this.file.get(versionKey) !== version) return;\n        (0, _features.verifyUsedFeatures)(path, this.file);\n        const loose = (0, _features.isLoose)(this.file, feature);\n        let constructor;\n        let isDecorated = (0, _decorators.hasOwnDecorators)(path.node);\n        const props = [];\n        const elements = [];\n        const computedPaths = [];\n        const privateNames = new Set();\n        const body = path.get(\"body\");\n\n        for (const path of body.get(\"body\")) {\n          (0, _features.verifyUsedFeatures)(path, this.file);\n\n          if (path.node.computed) {\n            computedPaths.push(path);\n          }\n\n          if (path.isPrivate()) {\n            const {\n              name\n            } = path.node.key.id;\n            const getName = `get ${name}`;\n            const setName = `set ${name}`;\n\n            if (path.node.kind === \"get\") {\n              if (privateNames.has(getName) || privateNames.has(name) && !privateNames.has(setName)) {\n                throw path.buildCodeFrameError(\"Duplicate private field\");\n              }\n\n              privateNames.add(getName).add(name);\n            } else if (path.node.kind === \"set\") {\n              if (privateNames.has(setName) || privateNames.has(name) && !privateNames.has(getName)) {\n                throw path.buildCodeFrameError(\"Duplicate private field\");\n              }\n\n              privateNames.add(setName).add(name);\n            } else {\n              if (privateNames.has(name) && !privateNames.has(getName) && !privateNames.has(setName) || privateNames.has(name) && (privateNames.has(getName) || privateNames.has(setName))) {\n                throw path.buildCodeFrameError(\"Duplicate private field\");\n              }\n\n              privateNames.add(name);\n            }\n          }\n\n          if (path.isClassMethod({\n            kind: \"constructor\"\n          })) {\n            constructor = path;\n          } else {\n            elements.push(path);\n\n            if (path.isProperty() || path.isPrivate()) {\n              props.push(path);\n            }\n          }\n\n          if (!isDecorated) isDecorated = (0, _decorators.hasOwnDecorators)(path.node);\n        }\n\n        if (!props.length && !isDecorated) return;\n        let ref;\n\n        if (path.isClassExpression() || !path.node.id) {\n          (0, _helperFunctionName().default)(path);\n          ref = path.scope.generateUidIdentifier(\"class\");\n        } else {\n          ref = path.node.id;\n        }\n\n        const privateNamesMap = (0, _fields.buildPrivateNamesMap)(props);\n        const privateNamesNodes = (0, _fields.buildPrivateNamesNodes)(privateNamesMap, loose, state);\n        (0, _fields.transformPrivateNamesUsage)(ref, path, privateNamesMap, loose, state);\n        let keysNodes, staticNodes, instanceNodes, wrapClass;\n\n        if (isDecorated) {\n          staticNodes = keysNodes = [];\n          ({\n            instanceNodes,\n            wrapClass\n          } = (0, _decorators.buildDecoratedClass)(ref, path, elements, this.file));\n        } else {\n          keysNodes = (0, _misc.extractComputedKeys)(ref, path, computedPaths, this.file);\n          ({\n            staticNodes,\n            instanceNodes,\n            wrapClass\n          } = (0, _fields.buildFieldsInitNodes)(ref, path.node.superClass, props, privateNamesMap, state, loose));\n        }\n\n        if (instanceNodes.length > 0) {\n          (0, _misc.injectInitialization)(path, constructor, instanceNodes, (referenceVisitor, state) => {\n            if (isDecorated) return;\n\n            for (const prop of props) {\n              if (prop.node.static) continue;\n              prop.traverse(referenceVisitor, state);\n            }\n          });\n        }\n\n        path = wrapClass(path);\n        path.insertBefore(keysNodes);\n        path.insertAfter([...privateNamesNodes, ...staticNodes]);\n      },\n\n      PrivateName(path) {\n        if (this.file.get(versionKey) !== version) return;\n        throw path.buildCodeFrameError(`Unknown PrivateName \"${path}\"`);\n      },\n\n      ExportDefaultDeclaration(path) {\n        if (this.file.get(versionKey) !== version) return;\n        const decl = path.get(\"declaration\");\n\n        if (decl.isClassDeclaration() && (0, _decorators.hasDecorators)(decl.node)) {\n          if (decl.node.id) {\n            (0, _helperSplitExportDeclaration().default)(path);\n          } else {\n            decl.node.type = \"ClassExpression\";\n          }\n        }\n      }\n\n    }\n  };\n}"]}