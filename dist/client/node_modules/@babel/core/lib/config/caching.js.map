{"version":3,"sources":["../../../../../../../client/node_modules/@babel/core/lib/config/caching.js"],"names":["Object","defineProperty","exports","value","makeStrongCache","makeWeakCache","assertSimpleType","handler","makeCachedFunction","Map","WeakMap","callCache","cachedFunction","arg","data","cachedValue","get","_ref","valid","cache","CacheConfigurator","configured","forever","deactivate","mode","set","validator","push","_active","_never","_forever","_invalidate","_configured","_pairs","_data","makeSimpleConfigurator","Error","key","pairs","every","fn","cacheFn","val","never","using","cb","invalidate"],"mappings":"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","file":"caching.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.makeStrongCache = makeStrongCache;\nexports.makeWeakCache = makeWeakCache;\nexports.assertSimpleType = assertSimpleType;\n\nfunction makeStrongCache(handler) {\n  return makeCachedFunction(new Map(), handler);\n}\n\nfunction makeWeakCache(handler) {\n  return makeCachedFunction(new WeakMap(), handler);\n}\n\nfunction makeCachedFunction(callCache, handler) {\n  return function cachedFunction(arg, data) {\n    let cachedValue = callCache.get(arg);\n\n    if (cachedValue) {\n      for (const _ref of cachedValue) {\n        const {\n          value,\n          valid\n        } = _ref;\n        if (valid(data)) return value;\n      }\n    }\n\n    const cache = new CacheConfigurator(data);\n    const value = handler(arg, cache);\n    if (!cache.configured()) cache.forever();\n    cache.deactivate();\n\n    switch (cache.mode()) {\n      case \"forever\":\n        cachedValue = [{\n          value,\n          valid: () => true\n        }];\n        callCache.set(arg, cachedValue);\n        break;\n\n      case \"invalidate\":\n        cachedValue = [{\n          value,\n          valid: cache.validator()\n        }];\n        callCache.set(arg, cachedValue);\n        break;\n\n      case \"valid\":\n        if (cachedValue) {\n          cachedValue.push({\n            value,\n            valid: cache.validator()\n          });\n        } else {\n          cachedValue = [{\n            value,\n            valid: cache.validator()\n          }];\n          callCache.set(arg, cachedValue);\n        }\n\n    }\n\n    return value;\n  };\n}\n\nclass CacheConfigurator {\n  constructor(data) {\n    this._active = true;\n    this._never = false;\n    this._forever = false;\n    this._invalidate = false;\n    this._configured = false;\n    this._pairs = [];\n    this._data = data;\n  }\n\n  simple() {\n    return makeSimpleConfigurator(this);\n  }\n\n  mode() {\n    if (this._never) return \"never\";\n    if (this._forever) return \"forever\";\n    if (this._invalidate) return \"invalidate\";\n    return \"valid\";\n  }\n\n  forever() {\n    if (!this._active) {\n      throw new Error(\"Cannot change caching after evaluation has completed.\");\n    }\n\n    if (this._never) {\n      throw new Error(\"Caching has already been configured with .never()\");\n    }\n\n    this._forever = true;\n    this._configured = true;\n  }\n\n  never() {\n    if (!this._active) {\n      throw new Error(\"Cannot change caching after evaluation has completed.\");\n    }\n\n    if (this._forever) {\n      throw new Error(\"Caching has already been configured with .forever()\");\n    }\n\n    this._never = true;\n    this._configured = true;\n  }\n\n  using(handler) {\n    if (!this._active) {\n      throw new Error(\"Cannot change caching after evaluation has completed.\");\n    }\n\n    if (this._never || this._forever) {\n      throw new Error(\"Caching has already been configured with .never or .forever()\");\n    }\n\n    this._configured = true;\n    const key = handler(this._data);\n\n    this._pairs.push([key, handler]);\n\n    return key;\n  }\n\n  invalidate(handler) {\n    if (!this._active) {\n      throw new Error(\"Cannot change caching after evaluation has completed.\");\n    }\n\n    if (this._never || this._forever) {\n      throw new Error(\"Caching has already been configured with .never or .forever()\");\n    }\n\n    this._invalidate = true;\n    this._configured = true;\n    const key = handler(this._data);\n\n    this._pairs.push([key, handler]);\n\n    return key;\n  }\n\n  validator() {\n    const pairs = this._pairs;\n    return data => pairs.every(([key, fn]) => key === fn(data));\n  }\n\n  deactivate() {\n    this._active = false;\n  }\n\n  configured() {\n    return this._configured;\n  }\n\n}\n\nfunction makeSimpleConfigurator(cache) {\n  function cacheFn(val) {\n    if (typeof val === \"boolean\") {\n      if (val) cache.forever();else cache.never();\n      return;\n    }\n\n    return cache.using(() => assertSimpleType(val()));\n  }\n\n  cacheFn.forever = () => cache.forever();\n\n  cacheFn.never = () => cache.never();\n\n  cacheFn.using = cb => cache.using(() => assertSimpleType(cb()));\n\n  cacheFn.invalidate = cb => cache.invalidate(() => assertSimpleType(cb()));\n\n  return cacheFn;\n}\n\nfunction assertSimpleType(value) {\n  if (value != null && typeof value !== \"string\" && typeof value !== \"boolean\" && typeof value !== \"number\") {\n    throw new Error(\"Cache keys must be either string, boolean, number, null, or undefined.\");\n  }\n\n  return value;\n}"]}